<?php

/********************
 *
 *	meeting_page_layout.php
 *	---------
 *	edit settings for page header and footer
 *	
 *******************/

require('./lib/cl_gui_menulist.lib.php');
require('./lib/cl_gui_page.lib.php');
include('./lib/cl_gui_select.lib.php');
include('./lib/cl_gui_dropdown.lib.php');

require('./lib/common.lib.php');

if(AA_connectToDB() == FALSE)	{		// invalid DB connection
	return;
}
if(AA_checkMeetingID() == FALSE) {		// no meeting selected
	return;		// abort
}

$arg = "";
if(isset($_POST['arg'])){
	$arg = $_POST['arg'];
}elseif(isset($_GET['arg'])){
	$arg = $_GET['arg'];
}

$tempdir = "tmp/";

if($arg == "save"){
	// copy pictures
	$pics = array();
	foreach($_FILES as $key => $file){
		if(!empty($file['name'])){
			move_uploaded_file($file['tmp_name'], $tempdir.$file['name']);
			$pics[$key] = $file['name'];
		}else{
			$pics[$key] = $_POST['c'.$key];
		}
	}
	
	if(empty($_POST['item'])){
		// create new page layout entry
		mysql_query("INSERT INTO layout SET
				TypTL = '".$_POST['type_tl']."'
				, TextTL = '".$_POST['text_tl']."'
				, BildTL = '".$pics['pic_tl']."'
				, TypTC = '".$_POST['type_tc']."'
				, TextTC = '".$_POST['text_tc']."'
				, BildTC = '".$pics['pic_tc']."'
				, TypTR = '".$_POST['type_tr']."'
				, TextTR = '".$_POST['text_tr']."'
				, BildTR = '".$pics['pic_tr']."'
				, TypBL = '".$_POST['type_bl']."'
				, TextBL = '".$_POST['text_bl']."'
				, BildBL = '".$pics['pic_bl']."'
				, TypBC = '".$_POST['type_bc']."'
				, TextBC = '".$_POST['text_bc']."'
				, BildBC = '".$pics['pic_bc']."'
				, TypBR = '".$_POST['type_br']."'
				, TextBR = '".$_POST['text_br']."'
				, BildBR = '".$pics['pic_br']."'
				, xMeeting = ".$_COOKIE['meeting_id']);
	}else{
		// update entry
		mysql_query("UPDATE layout SET
				TypTL = '".$_POST['type_tl']."'
				, TextTL = '".$_POST['text_tl']."'
				, BildTL = '".$pics['pic_tl']."'
				, TypTC = '".$_POST['type_tc']."'
				, TextTC = '".$_POST['text_tc']."'
				, BildTC = '".$pics['pic_tc']."'
				, TypTR = '".$_POST['type_tr']."'
				, TextTR = '".$_POST['text_tr']."'
				, BildTR = '".$pics['pic_tr']."'
				, TypBL = '".$_POST['type_bl']."'
				, TextBL = '".$_POST['text_bl']."'
				, BildBL = '".$pics['pic_bl']."'
				, TypBC = '".$_POST['type_bc']."'
				, TextBC = '".$_POST['text_bc']."'
				, BildBC = '".$pics['pic_bc']."'
				, TypBR = '".$_POST['type_br']."'
				, TextBR = '".$_POST['text_br']."'
				, BildBR = '".$pics['pic_br']."'
			WHERE
				xLayout = ".$_POST['item']);
	}
	
	if(mysql_errno() > 0){
		AA_printErrorMsg(mysql_errno().": ".mysql_error());
	}
}


$res = mysql_query("	SELECT
				*
			FROM
				layout
			WHERE
				xMeeting = ". $_COOKIE['meeting_id']);
if(mysql_errno() > 0){
	AA_printErrorMsg(mysql_errno().": ".mysql_error());
}else{
	$row = mysql_fetch_assoc($res);
	if(mysql_num_rows($res)==0){
		// set standard layout
		$row['TypTL']=1;
		$row['BildTC']="athletica-logo.png";
		$row['TypTC']=6;
		$row['TypTR']=3;
		$row['TypBL']=4;
		$row['TypBC']=2;
		$row['TypBR']=0;
	}
}

//
// display the 6 positions for page layout
//

$page = new GUI_Page('meeting_page_layout');
$page->startPage();
$page->printPageTitle($strPageLayout);

$menu = new GUI_Menulist();
$menu->addButton($cfgURLDocumentation . 'help/administration/index.html', $strHelp, '_blank');
$menu->printMenu();
?>
<p/>

<table class='dialog'>
<form name="layout" method="POST" action="meeting_page_layout.php" enctype="multipart/form-data">
<input type="hidden" name="arg" value="save">
<input type="hidden" name="item" value="<?php echo $row['xLayout'] ?>">
<tr>
	<th class='dialog'><?php echo $strPosition; ?></th>
	<th class='dialog'><?php echo $strDisplay; ?></th>
	<th class='dialog'><?php echo $strOwnText; ?></th>
	<th class='dialog' colspan="3"><?php echo $strPicture; ?></th>
</tr>

<tr>
	<td class='dialog'><?php echo $strPosTL ?></td>
	<?php
		$dd = new GUI_ConfigDropDown('type_tl', 'cfgPageLayout', $row['TypTL']);
	?>
	<td class='forms'>
		<input type="text" name="text_tl" maxlenght="255" size="30" value="<?php echo $row['TextTL'] ?>"
			onchange="document.forms[0].type_tl.value = 5">
	</td>
	<td class='forms'>
		<input type="file" name="pic_tl">
	</td>
	<td>
		<?php
		if(!empty($row['BildTL'])){
			?>
		<img src="tmp/<?php echo $row['BildTL'] ?>" height="30px" alt="">
		<input type="hidden" name="cpic_tl" value="<?php echo $row['BildTL'] ?>">
			<?php
		}
		?>
	</td>
	<td>
		<?php
		if(!empty($row['BildTL'])){
			?>
		<input type="button" value="<?php echo $strPicture." ".$strDelete ?>"
			onclick="document.forms[0].cpic_tl.value='';
				document.forms[0].submit()">
			<?php
		}
		?>
	</td>
</tr>

<tr>
	<td class='dialog'><?php echo $strPosTC ?></td>
	<?php
		$dd = new GUI_ConfigDropDown('type_tc', 'cfgPageLayout', $row['TypTC']);
	?>
	<td class='forms'>
		<input type="text" name="text_tc" maxlenght="255" size="30" value="<?php echo $row['TextTC'] ?>"
			onchange="document.forms[0].type_tc.value = 5">
	</td>
	<td class='forms'>
		<input type="file" name="pic_tc">
	</td>
	<td>
		<?php
		if(!empty($row['BildTC'])){
			?>
		<img src="tmp/<?php echo $row['BildTC'] ?>" height="30px" alt="">
		<input type="hidden" name="cpic_tc" value="<?php echo $row['BildTC'] ?>">
			<?php
		}
		?>
	</td>
	<td>
		<?php
		if(!empty($row['BildTC'])){
			?>
		<input type="button" value="<?php echo $strPicture." ".$strDelete ?>"
			onclick="document.forms[0].cpic_tc.value='';
				document.forms[0].submit()">
			<?php
		}
		?>
	</td>
</tr>

<tr>
	<td class='dialog'><?php echo $strPosTR ?></td>
	<?php
		$dd = new GUI_ConfigDropDown('type_tr', 'cfgPageLayout', $row['TypTR']);
	?>
	<td class='forms'>
		<input type="text" name="text_tr" maxlenght="255" size="30" value="<?php echo $row['TextTR'] ?>"
			onchange="document.forms[0].type_tr.value = 5">
	</td>
	<td class='forms'>
		<input type="file" name="pic_tr">
	</td>
	<td>
		<?php
		if(!empty($row['BildTR'])){
			?>
		<img src="tmp/<?php echo $row['BildTR'] ?>" height="30px" alt="">
		<input type="hidden" name="cpic_tr" value="<?php echo $row['BildTR'] ?>">
			<?php
		}
		?>
	</td>
	<td>
		<?php
		if(!empty($row['BildTR'])){
			?>
		<input type="button" value="<?php echo $strPicture." ".$strDelete ?>"
			onclick="document.forms[0].cpic_tr.value='';
				document.forms[0].submit()">
			<?php
		}
		?>
	</td>
</tr>

<tr>
	<td class='dialog'><?php echo $strPosBL ?></td>
	<?php
		$dd = new GUI_ConfigDropDown('type_bl', 'cfgPageLayout', $row['TypBL']);
	?>
	<td class='forms'>
		<input type="text" name="text_bl" maxlenght="255" size="30" value="<?php echo $row['TextBL'] ?>"
			onchange="document.forms[0].type_bl.value = 5">
	</td>
	<td class='forms'>
		<input type="file" name="pic_bl">
	</td>
	<td>
		<?php
		if(!empty($row['BildBL'])){
			?>
		<img src="tmp/<?php echo $row['BildBL'] ?>" height="30px" alt="">
		<input type="hidden" name="cpic_bl" value="<?php echo $row['BildBL'] ?>">
			<?php
		}
		?>
	</td>
	<td>
		<?php
		if(!empty($row['BildBL'])){
			?>
		<input type="button" value="<?php echo $strPicture." ".$strDelete ?>"
			onclick="document.forms[0].cpic_bl.value='';
				document.forms[0].submit()">
			<?php
		}
		?>
	</td>
</tr>

<tr>
	<td class='dialog'><?php echo $strPosBC ?></td>
	<?php
		$dd = new GUI_ConfigDropDown('type_bc', 'cfgPageLayout', $row['TypBC']);
	?>
	<td class='forms'>
		<input type="text" name="text_bc" maxlenght="255" size="30" value="<?php echo $row['TextBC'] ?>"
			onchange="document.forms[0].type_bc.value = 5">
	</td>
	<td class='forms'>
		<input type="file" name="pic_bc">
	</td>
	<td>
		<?php
		if(!empty($row['BildBC'])){
			?>
		<img src="tmp/<?php echo $row['BildBC'] ?>" height="30px" alt="">
		<input type="hidden" name="cpic_bc" value="<?php echo $row['BildBC'] ?>">
			<?php
		}
		?>
	</td>
	<td>
		<?php
		if(!empty($row['BildBC'])){
			?>
		<input type="button" value="<?php echo $strPicture." ".$strDelete ?>"
			onclick="document.forms[0].cpic_bc.value='';
				document.forms[0].submit()">
			<?php
		}
		?>
	</td>
</tr>

<tr>
	<td class='dialog'><?php echo $strPosBR ?></td>
	<?php
		$dd = new GUI_ConfigDropDown('type_br', 'cfgPageLayout', $row['TypBR']);
	?>
	<td class='forms'>
		<input type="text" name="text_br" maxlenght="255" size="30" value="<?php echo $row['TextBR'] ?>"
			onchange="document.forms[0].type_br.value = 5">
	</td>
	<td class='forms'>
		<input type="file" name="pic_br">
	</td>
	<td>
		<?php
		if(!empty($row['BildBR'])){
			?>
		<img src="tmp/<?php echo $row['BildBR'] ?>" height="30px" alt="">
		<input type="hidden" name="cpic_br" value="<?php echo $row['BildBR'] ?>">
			<?php
		}
		?>
	</td>
	<td>
		<?php
		if(!empty($row['BildBR'])){
			?>
		<input type="button" value="<?php echo $strPicture." ".$strDelete ?>"
			onclick="document.forms[0].cpic_br.value='';
				document.forms[0].submit()">
			<?php
		}
		?>
	</td>
</tr>
</table>

<br>
<input type="submit" value="<?php echo $strSave ?>">
</form>


<?php
$page->endPage();

?>
